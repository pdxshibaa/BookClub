import{r as h,j as t,c as ge}from"./vendor-PmdL_7_S.js";import{i as fe,g as ye,a as be,o as we,q as xe,b as je,c as G,d as ke,e as X,s as ve,f as Ce,h as ee,u as Ie,j as Se}from"./firebase-8Ol5BuhR.js";(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))y(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const v of l.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&y(v)}).observe(document,{childList:!0,subtree:!0});function f(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function y(a){if(a.ep)return;a.ep=!0;const l=f(a);fetch(a.href,l)}})();const Ne={apiKey:"AIzaSyAbIWMqgTOnkQ0jE02f7BpDm0JkhZYpjQk",authDomain:"bookclubbackend.firebaseapp.com",projectId:"bookclubbackend",storageBucket:"bookclubbackend.firebasestorage.app",messagingSenderId:"219050497346",appId:"1:219050497346:web:85e8c71bf341ca3c8164db",measurementId:"G-ZGKWVBZN6G"},te=fe(Ne),A=ye(te),Y=be(te),Le=["sharon@tutorshiba.com"],De="https://docs.google.com/spreadsheets/d/1uVwfBjOxbpjiKBwH7-Rfakkgr3lu-krG3EcdzrMEmW4/export?format=csv",_e="pQLpMHVAOBKvdXVGdoigd7ZVHNu47E25cZoN2A40sGGSBRiX",Ae="AIzaSyCOJcLj0MlDQAsiYmZ174XFBqm3g2NYUjs",F=i=>{if(!i)return new Date(0);let b=new Date(i);if(!isNaN(b.getTime()))return b;const f=i.trim().split(/[\s-]+/);if(f.length>=2){const y=f[0].toLowerCase().substring(0,3),a=parseInt(f[f.length-1]),l={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};if(l[y]!==void 0&&!isNaN(a))return new Date(a,l[y],1)}return new Date(0)},Ee=()=>{const[i,b]=h.useState(null),[f,y]=h.useState(!1),[a,l]=h.useState(""),[v,V]=h.useState(""),[d,w]=h.useState("scheduled"),[z,$]=h.useState(""),[R,se]=h.useState(""),[K,E]=h.useState([]),[U,C]=h.useState(!1),[D,oe]=h.useState([]),x=e=>e&&Le.some(s=>s.toLowerCase()===e.email.toLowerCase());h.useEffect(()=>{const e=we(Y,s=>{b(s)});return()=>e()},[]),h.useEffect(()=>{const e=xe(G(A,"books"),je("sortDate","desc")),s=ke(e,n=>{const c=n.docs.map(o=>({...o.data(),key:o.id}));oe(c)});return()=>s()},[]);const re=async e=>{e.preventDefault();try{await Ce(Y,a,v),y(!1),l(""),V("")}catch(s){alert("Login failed: "+s.message)}},ne=async()=>{await ve(Y)},Q=async e=>{if(!e||!e.trim())return;C(!0),w("search"),E([]);const s=new AbortController,n=setTimeout(()=>s.abort(),15e3),c=`&key=${Ae}`;try{const o=await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(e)}&maxResults=40&printType=books${c}`,{signal:s.signal});if(clearTimeout(n),!o.ok)throw o.status===429?new Error("Please wait a moment and try again."):new Error(`API Error: ${o.status} ${o.statusText}`);const j=((await o.json()).items||[]).map(u=>{const p=u.volumeInfo.title,g=u.volumeInfo.authors||["Unknown"],I=g.join(" ");let _=null;if(u.volumeInfo.industryIdentifiers){const S=u.volumeInfo.industryIdentifiers.find(N=>N.type==="ISBN_13")||u.volumeInfo.industryIdentifiers.find(N=>N.type==="ISBN_10");S&&(_=S.identifier)}return{key:u.id,title:p,author_name:g,coverUrl:u.volumeInfo.imageLinks?.thumbnail?.replace("http:","https:"),isbn:_,goodreadsLink:`https://www.goodreads.com/search?q=${encodeURIComponent(p+" "+I)}`,wcclsLink:`https://wccls.bibliocommons.com/v2/search?query=${encodeURIComponent(p+" "+I)}&searchType=smart`,multcolibLink:`https://multcolib.bibliocommons.com/v2/search?query=${encodeURIComponent(p+" "+I)}&searchType=smart`}});E(j)}catch(o){o.name==="AbortError"?(console.error("Search timed out:",o),alert("The book search timed out. Please try again.")):(console.error("Error fetching books:",o),alert(`Failed to search books: ${o.message}`)),E([])}finally{clearTimeout(n),C(!1)}},ae=async e=>{e.preventDefault(),Q(z)},W=e=>{$(e),Q(e)},O=async e=>{C(!0),w("search");try{const s=await fetch(`https://api.nytimes.com/svc/books/v3/lists/current/${e}.json?api-key=${_e.trim()}`);if(!s.ok)throw new Error(`API Error: ${s.status} ${s.statusText}`);const c=((await s.json()).results?.books||[]).map(o=>({key:o.primary_isbn13||o.primary_isbn10||o.title,title:o.title,author_name:[o.author],coverUrl:o.book_image||`https://covers.openlibrary.org/b/isbn/${o.primary_isbn13}-M.jpg`,isbn:o.primary_isbn13,goodreadsLink:`https://www.goodreads.com/search?q=${encodeURIComponent(o.title+" "+o.author)}`,wcclsLink:`https://wccls.bibliocommons.com/v2/search?query=${encodeURIComponent(o.title+" "+o.author)}&searchType=smart`,multcolibLink:`https://multcolib.bibliocommons.com/v2/search?query=${encodeURIComponent(o.title+" "+o.author)}&searchType=smart`}));E(c)}catch(s){console.error("Error fetching NYT list:",s),alert(`Failed to fetch NYT Bestsellers: ${s.message}`)}finally{C(!1)}},P=async(e,s="suggested")=>{if(!i){alert("Please log in to add books!"),y(!0);return}if(s!=="suggested"&&!x(i)){alert("Only admins can add to the Read or Scheduled lists.");return}if(window.confirm(`Add "${e.title}" to the ${s} list?`)){let n=s==="read"?new Date().toLocaleDateString():"",c=new Date().toISOString(),o=i.email.split("@")[0],m="";const j=window.prompt("Enter Month/Year (e.g. 'January 2025'):",n);if(j!==null){n=j;const g=F(n);g.getTime()!==new Date(0).getTime()&&(c=g.toISOString())}const u=window.prompt("Enter Proposer Name:",o);u!==null&&(o=u);const p=window.prompt("Enter Comments:","");p!==null&&(m=p);try{await X(G(A,"books"),{title:e.title,author_name:e.author_name,coverUrl:e.coverUrl||null,isbn:e.isbn||null,status:s,sortDate:c,displayDate:n,proposer:o,comments:m,goodreadsLink:`https://www.goodreads.com/search?q=${encodeURIComponent(e.title+" "+(Array.isArray(e.author_name)?e.author_name.join(" "):e.author_name))}`,wcclsLink:`https://wccls.bibliocommons.com/v2/search?query=${encodeURIComponent(e.title+" "+(Array.isArray(e.author_name)?e.author_name.join(" "):e.author_name))}&searchType=smart`,multcolibLink:`https://multcolib.bibliocommons.com/v2/search?query=${encodeURIComponent(e.title+" "+(Array.isArray(e.author_name)?e.author_name.join(" "):e.author_name))}&searchType=smart`,attemptedV2:!!e.coverUrl}),alert("Book added!"),w(s),$("")}catch(g){console.error("Error adding book: ",g),alert("Error adding book.")}}},ie=async e=>{if(!i||!x(i))return;const s=window.prompt("Edit Date (Month/Year):",e.displayDate||"");if(s===null)return;const n=window.prompt("Edit Proposer:",e.proposer||"");if(n===null)return;const c=window.prompt("Edit Comments:",e.comments||"");if(c===null)return;let o=e.sortDate;if(s!==e.displayDate){const m=F(s);m.getTime()!==new Date(0).getTime()&&(o=m.toISOString())}try{const m=ee(A,"books",e.key);await Ie(m,{displayDate:s,proposer:n,comments:c,sortDate:o})}catch(m){console.error("Error updating book: ",m),alert("Error updating book.")}},ce=async e=>{!i||!x(i)||window.confirm("Are you sure you want to delete this book?")&&await Se(ee(A,"books",e))},le=async()=>{if(!(!i||!x(i))&&window.confirm("Import new books from Google Sheet?")){C(!0);try{const n=(await(await fetch(De)).text()).split(`
`);if(n.length<2)throw new Error("No data found");const c=n[0].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(r=>r.replace(/^"|"$/g,"").trim().toLowerCase()),o=c.findIndex(r=>r.includes("title")||r.includes("book")),m=c.findIndex(r=>r.includes("author")),j=c.findIndex(r=>r.includes("month")||r.includes("read")||r.includes("year")),u=c.findIndex(r=>r.includes("proposer")||r.includes("host")),p=c.findIndex(r=>r.includes("isbn")),g=c.findIndex(r=>r.includes("comment")||r.includes("note")),I=o!==-1?o:0,_=m!==-1?m:1;let S=0;const N=[],H=new Set(D.map(r=>r.title.toLowerCase().trim()));for(let r=1;r<n.length;r++){const k=n[r].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(pe=>pe.replace(/^"|"$/g,"").trim());if(k.length<=Math.max(I,_))continue;const L=k[I],T=k[_];if(!L)continue;const J=L.toLowerCase().trim();if(H.has(J))continue;H.add(J);const q=j!==-1&&k[j]||"",de=u!==-1&&k[u]||"",me=p!==-1?k[p]:null,ue=g!==-1?k[g]:"";let B=F(q),M="read";/(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i.test(q)?B>new Date&&(M="scheduled"):M="suggested",B.setTime(B.getTime()+r*1e3);const he={title:L,author_name:[T],isbn:me,coverUrl:null,status:M,sortDate:B.toISOString(),displayDate:q,proposer:de,comments:ue,goodreadsLink:`https://www.goodreads.com/search?q=${encodeURIComponent(L+" "+T)}`,wcclsLink:`https://wccls.bibliocommons.com/v2/search?query=${encodeURIComponent(L+" "+T)}&searchType=smart`,multcolibLink:`https://multcolib.bibliocommons.com/v2/search?query=${encodeURIComponent(L+" "+T)}&searchType=smart`,attemptedV2:!1};N.push(X(G(A,"books"),he)),S++}await Promise.all(N),alert(S>0?`Successfully imported ${S} new books!`:"No new books found to import.")}catch(e){console.error("Migration failed",e),alert("Migration failed: "+e.message)}finally{C(!1)}}},Z=()=>{let e=[];return d==="search"?e=K:(e=D.filter(s=>s.status===d&&(s.title.toLowerCase().includes(R.toLowerCase())||(Array.isArray(s.author_name)?s.author_name.join(" "):s.author_name||"").toLowerCase().includes(R.toLowerCase()))),d==="scheduled"?e.sort((s,n)=>new Date(s.sortDate)-new Date(n.sortDate)):e.sort((s,n)=>new Date(n.sortDate)-new Date(s.sortDate))),e};return t.jsxs("div",{className:"app-container",children:[t.jsxs("header",{children:[t.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"10px"},children:i?t.jsxs("div",{style:{fontSize:"0.9rem"},children:["Logged in as ",i.email,x(i)&&t.jsx("button",{onClick:le,style:{marginLeft:"10px",cursor:"pointer",backgroundColor:"#e67e22",color:"white",border:"none",borderRadius:"4px",padding:"2px 8px"},children:"Import CSV"}),t.jsx("button",{onClick:ne,style:{marginLeft:"10px",cursor:"pointer"},children:"Logout"})]}):t.jsx("button",{onClick:()=>y(!f),style:{cursor:"pointer"},children:"Member Login"})}),f&&!i&&t.jsxs("form",{onSubmit:re,style:{marginBottom:"20px",padding:"15px",background:"#f0f0f0",borderRadius:"8px"},children:[t.jsx("input",{type:"email",placeholder:"Email",value:a,onChange:e=>l(e.target.value),style:{marginRight:"10px",padding:"5px"}}),t.jsx("input",{type:"password",placeholder:"Password",value:v,onChange:e=>V(e.target.value),style:{marginRight:"10px",padding:"5px"}}),t.jsx("button",{type:"submit",style:{padding:"5px 10px"},children:"Login"})]}),t.jsx("img",{src:"https://images.unsplash.com/photo-1495446815901-a7297e633e8d?auto=format&fit=crop&w=800&q=80",alt:"Books and coffee",className:"header-image"}),t.jsx("h1",{children:"ðŸ“š Book Club Tracker"}),t.jsx("p",{children:"Books we've read, scheduled books, and suggested books."})]}),t.jsxs("form",{onSubmit:ae,className:"search-section",children:[t.jsx("input",{type:"text",className:"search-input",placeholder:"Search Google Books...",value:z,onChange:e=>$(e.target.value)}),t.jsx("button",{type:"submit",className:"search-btn",disabled:U,children:U?"Searching...":"Search"})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px",marginBottom:"20px",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>O("combined-print-and-e-book-fiction"),className:"tab-btn",style:{fontSize:"0.85rem",padding:"0.5rem 1rem",background:"#e1bee7",color:"#4a148c"},children:"ðŸ† Browse NYT Fiction"}),t.jsx("button",{onClick:()=>O("combined-print-and-e-book-nonfiction"),className:"tab-btn",style:{fontSize:"0.85rem",padding:"0.5rem 1rem",background:"#e1bee7",color:"#4a148c"},children:"ðŸ† Browse NYT Non-Fiction"}),t.jsx("button",{onClick:()=>O("trade-fiction-paperback"),className:"tab-btn",style:{fontSize:"0.85rem",padding:"0.5rem 1rem",background:"#e1bee7",color:"#4a148c"},children:"ðŸ“– Browse NYT Book Club Picks"}),t.jsx("button",{onClick:()=>W("subject:mystery"),className:"tab-btn",style:{fontSize:"0.85rem",padding:"0.5rem 1rem",background:"#e1bee7",color:"#4a148c"},children:"ðŸ•µï¸ Browse Mystery"}),t.jsx("button",{onClick:()=>W("subject:biography"),className:"tab-btn",style:{fontSize:"0.85rem",padding:"0.5rem 1rem",background:"#e1bee7",color:"#4a148c"},children:"ðŸ‘¤ Browse Biographies"})]}),t.jsxs("div",{className:"tabs",children:[t.jsxs("button",{className:`tab-btn ${d==="scheduled"?"active":""}`,onClick:()=>w("scheduled"),children:["Scheduled ðŸ“… Books (",D.filter(e=>e.status==="scheduled").length,")"]}),t.jsxs("button",{className:`tab-btn ${d==="suggested"?"active":""}`,onClick:()=>w("suggested"),children:["ðŸ’¡ Suggested and Extras (",D.filter(e=>e.status==="suggested").length,")"]}),t.jsxs("button",{className:`tab-btn ${d==="read"?"active":""}`,onClick:()=>w("read"),children:["ðŸ“šBooks We've Read (",D.filter(e=>e.status==="read").length,")"]}),(K.length>0||d==="search")&&t.jsx("button",{className:`tab-btn ${d==="search"?"active":""}`,onClick:()=>w("search"),children:"ðŸ” Search Results"})]}),d!=="search"&&t.jsx("input",{type:"text",className:"filter-input",placeholder:`Filter ${d} books...`,value:R,onChange:e=>se(e.target.value)}),t.jsx("div",{className:"book-grid",children:Z().length===0?t.jsx("div",{className:"empty-state",children:d==="search"?U?"Searching...":"No results found. Try a different search.":"No books in this list yet."}):Z().map(e=>t.jsx("div",{className:"book-card",children:t.jsxs("div",{className:"book-info",children:[t.jsx("h3",{className:"book-title",children:e.title}),t.jsx("p",{className:"book-author",children:e.author_name?Array.isArray(e.author_name)?e.author_name.join(", "):e.author_name:"Unknown Author"}),e.displayDate&&t.jsxs("p",{className:`book-date ${e.status==="scheduled"?"highlight":""}`,children:["ðŸ“… ",e.displayDate]}),e.proposer&&t.jsxs("p",{className:"book-meta",children:["ðŸ‘¤ Proposed by: ",e.proposer]}),e.comments&&t.jsxs("p",{className:"book-comments",children:['"',e.comments,'"']}),e.goodreadsLink&&t.jsx("a",{href:e.goodreadsLink,target:"_blank",rel:"noopener noreferrer",className:"book-link",style:{display:"block",marginTop:"0.5rem"},children:"View on Goodreads â†’"}),(e.wcclsLink||e.title)&&t.jsx("a",{href:e.wcclsLink||`https://wccls.bibliocommons.com/v2/search?query=${encodeURIComponent(e.title+(e.author_name?" "+(Array.isArray(e.author_name)?e.author_name.join(" "):e.author_name):""))}&searchType=smart`,target:"_blank",rel:"noopener noreferrer",className:"book-link",children:"View on WCCLS â†’"}),(e.multcolibLink||e.title)&&t.jsx("a",{href:e.multcolibLink||`https://multcolib.bibliocommons.com/v2/search?query=${encodeURIComponent(e.title+(e.author_name?" "+(Array.isArray(e.author_name)?e.author_name.join(" "):e.author_name):""))}&searchType=smart`,target:"_blank",rel:"noopener noreferrer",className:"book-link",children:"View on Multnomah â†’"}),t.jsxs("div",{className:"actions",children:[d==="search"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn btn-suggest",onClick:()=>P(e,"suggested"),children:"+ Add to Suggestions"}),x(i)&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn btn-read",onClick:()=>P(e,"read"),style:{marginTop:"5px"},children:"+ Add to Read"}),t.jsx("button",{className:"action-btn btn-suggest",style:{backgroundColor:"#8e44ad",marginTop:"5px"},onClick:()=>P(e,"scheduled"),children:"+ Add to Scheduled"})]})]}),x(i)&&d!=="search"&&t.jsxs("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:[t.jsx("button",{className:"action-btn",style:{backgroundColor:"#2980b9",color:"white"},onClick:()=>ie(e),children:"Edit"}),t.jsx("button",{className:"action-btn btn-remove",onClick:()=>ce(e.key),children:"Delete"})]})]})]})},e.key))})]})};ge.createRoot(document.getElementById("root")).render(t.jsx(h.StrictMode,{children:t.jsx(Ee,{})}));
